# RPC란 무엇인가

RPC는 **Remote Procedure Call**의 약자이다.

이름 그대로 해석하면 원격에 있는 프로시저를 호출하는 방식이다.

즉, 한 프로세스에서 실행되는 코드가 다른 주소 공간, 다른 머신에서 실행되는 코드를 마치 로컬 함수처럼 호출할 수 있게 만든다.

개발자가 보는 코드는 다음과 같다.

```java
userService.getUser(userId);
```    

하지만 실제로는

- 네트워크를 통해 요청이 전달되고
- 다른 서버에서 코드가 실행되며
- 결과가 다시 네트워크를 통해 반환된다.

RPC의 핵심은 이 과정을 **함수 호출이라는 추상화로 감춘다는 점**이다.

---

### 프로시저란 무엇인가

RPC를 이해하려면 먼저 프로시저라는 개념이 필요하다.

프로시저는
- 특정 작업을 수행하는 코드 묶음이며
- 내부 구현을 감추고
- 이름을 통해 동작을 표현한다

중요한 점은 **호출자는 내부 구현을 알 필요가 없다는 것**이다.

```java
calculateTotalPrice();
sendNotification();
```

이 호출에서 중요한 것은 어떻게 계산하는지가 아니라 무엇을 하는지이다.
RPC는 이 개념을 **네트워크 너머로 확장**한 것이다.

---

### 왜 RPC가 필요했는가

단일 프로세스 환경에서는 함수 호출만으로 모든 작업을 처리할 수 있다.

하지만 분산 시스템에서는 상황이 달라진다.

- 서비스가 여러 프로세스, 여러 서버로 나뉜다.
- 프로세스 간 통신이 필수가 된다.
- 네트워크 통신은 복잡하고 실패 가능성이 높다.

기존 방식은 보통 다음과 같았다.

- HTTP 요청 직접 구성
- URL, Method, Body를 수동으로 정의
- 응답을 파싱해 로직에 연결

이 방식의 문제는 명확하다.

- 호출 의도가 코드에 드러나지 않는다.
- 인터페이스 불일치 위험이 크다.
- 타입 안정성이 약하다.

RPC는 이 문제를 이렇게 바꾼다.

> 네트워크 호출을 함수 호출로 추상화하자

---

### RPC의 기본 구조

RPC 호출은 보통 다음 단계를 거친다.

- 클라이언트는 로컬 함수처럼 호출한다.
- 인자는 직렬화되어 네트워크로 전송된다.
- 서버는 이를 실제 함수 호출로 변환한다.
- 결과를 다시 직렬화해 반환한다.

이 과정에서

- 네트워크
- 직렬화
- 실패 처리

는 모두 RPC 프레임워크 내부로 숨겨진다.

---

### RPC의 장점

RPC의 장점은 구조적으로 분명하다.

1. **코드가 동작 중심으로 작성된다.**

    ```java
    orderService.createOrder(order);
    ```

    URL이나 HTTP Method보다 의도가 더 직접적으로 드러난다.


2. **인터페이스 계약이 명확하다.**
- 메서드 시그니처가 명세가 된다.
- 타입 불일치는 컴파일 시점에 드러난다.

3. **성능 측면에서 유리하다.**
- JSON 대신 바이너리 직렬화 사용 가능.
- HTTP/2 기반 통신 가능.
- 내부 서비스 간 통신에 적합하다.

---

### RPC의 한계

RPC의 한계 역시 구조에서 비롯된다.

가장 큰 문제는  
**네트워크 호출이 로컬 호출처럼 보인다는 점**이다.

```java
userService.getUser();
```

이 코드는

- 지연될 수 있고
- 실패할 수 있으며
- 타임아웃이 발생할 수 있다

하지만 코드만 보면 이를 인식하기 어렵다.

또 하나의 문제는 **결합도**이다.

- 메서드 시그니처 변경은 곧바로 영향이 전파된다
- 버전 관리가 까다롭다

마지막으로 **디버깅이 어렵다.**

- 호출 흐름이 여러 프로세스를 넘는다
- 스택 트레이스가 끊어진다

RPC는 편의성을 얻는 대신 분산 시스템의 복잡성을 감춘다.

---

### RPC와 REST의 관점 차이

RPC와 REST의 차이는 구현 방식이 아니라 **문제를 바라보는 관점의 차이**이다.

- RPC는 동작을 호출한다
- REST는 리소스를 조작한다

RPC에서는

```java
createOrder()
cancelOrder()
```

와 같은 동작이 중심이 된다.

REST에서는

```java
POST /orders
DELETE /orders/{id}
```

처럼 리소스 상태 변화가 중심이다.

이 차이는 다음으로 이어진다.

- RPC는 내부 통신에 적합하다
- REST는 외부 공개 API에 적합하다
- RPC는 강한 계약을 가진다
- REST는 느슨한 결합을 가진다

---

### 정리

RPC는 단순한 통신 기술이 아니다.

**분산 환경에서 추상화를 어디까지 허용할 것인가에 대한 선택**이다.

- 함수 호출의 직관성
- 네트워크 실패의 현실
- 결합도와 성능 사이의 trade-off

RPC는 로컬 호출처럼 보이게 만들지만 절대로 로컬 호출은 아니다.

이 점을 인식하고 사용할 때 RPC는 강력한 도구가 된다.
