# 비례 배분 스케줄링

### 개념

비례 배분 스케줄링은 반환 시간이나 응답 시간을 최적화하는 대신 각 프로세스가 CPU를 일정 비율로 나누어 쓰도록 보장하는 스케줄링 방식이다.

공정 배분 스케줄링이라고도 부르며 핵심 목표는 단순하다.

누가 CPU를 얼마나 가져가야 하는지를 명확하게 제어하는 것이다.

즉, 빠른 응답보다는 공정한 CPU 분배 자체에 초점을 둔다.

---

### 추첨 스케줄링(Lottery Scheduling)의 기본 아이디어

추첨 스케줄링은 CPU 지분을 추첨권이라는 개념으로 표현한다.

각 프로세스는 일정 수의 추첨권을 가진다.

**프로세스가 가진 추첨권 수를 전체 추첨권 수로 나눈 비율**이 그 프로세스가 가져갈 CPU 비율이 된다.

CPU를 더 많이 사용해야 하는 프로세스일수록 더 많은 추첨권을 가진다.

---

### 동작 방식

스케줄러는 타임 슬라이스마다 다음 과정을 반복한다.

- 전체 추첨권 중 하나를 무작위로 선택한다
- 선택된 추첨권을 가진 프로세스를 실행한다

단기적으로는 결과가 흔들릴 수 있다.  
하지만 충분히 오랜 시간 동안 실행되면 각 프로세스는 자신의 추첨권 비율에 맞는 CPU 시간을 얻게 된다.

이 방식은 확률적으로 공정함을 달성한다.

---

### 장점과 한계

장점은 명확하다.

- 구조가 단순하다.
- 최악의 경우가 없다.
- CPU 지분을 직관적으로 표현할 수 있다.

하지만 한계도 분명하다.

- 짧은 시간 동안은 비율이 정확하지 않다.
- 응답 시간을 보장하지 않는다.
- I O가 많은 환경과는 잘 맞지 않는다.

이 방식은 CPU bound 작업 위주의 환경을 전제로 한다.

---

### 추첨 스케줄링의 확장 기법

추첨 스케줄링에는 몇 가지 실용적인 확장 기법이 존재한다.

**추첨권 화폐**는  
사용자나 그룹 단위로 추첨권을 관리하는 방식이다.

시스템은 이를 전역 기준의 추첨권으로 변환해 전체 스케줄링을 수행한다.

**추첨권 양도**는  
클라이언트 서버 구조에서 유용하다.

클라이언트가 서버에게 자신의 추첨권을 일시적으로 넘겨준다.

서버가 요청을 처리하는 동안 우선권을 높여 빠르게 실행할 수 있다.

작업이 끝나면 추첨권은 다시 원래 주인에게 돌아간다.

**추첨권 팽창**은  
프로세스가 스스로 추첨권 수를 조정하는 방식이다.

다만 이 방식은 서로 신뢰할 수 있는 환경에서만 사용 가능하다.

(신뢰할 수 있는 환경 == 같은 사용자 소유, 같은 어플리케이션 내부, 같은 시스템 컴포넌트)

---

### 보폭 스케줄링(Stride Scheduling) 개념

보폭 스케줄링은 추첨 스케줄링의 확률적 특성을 제거한 방식이다.

각 프로세스는 보폭이라는 값을 가진다.

보폭은 추첨권 수에 반비례한다.  
추첨권이 많을수록 보폭은 작아진다.

프로세스가 실행될 때마다 자신의 pass 값을 보폭만큼 증가시킨다.

스케줄러는 항상 pass 값이 가장 작은 프로세스를 선택해 실행한다.

이 방식은 매 스케줄링마다 정확한 CPU 비율을 보장한다.

---

### 추첨 스케줄링과의 비교

추첨 스케줄링은 확률적 방식이다.

구현이 단순하고 유연하지만 단기적으로는 불공정할 수 있다.

보폭 스케줄링은 결정론적 방식이다.

CPU 비율을 정확히 지키지만 상태 관리가 복잡하다.

새로운 프로세스가 도착했을 경우 pass 값을 적절히 초기화하지 않으면 CPU를 독점하는 문제가 발생할 수 있다.

이를 방지하기 위해 새 작업의 pass 값은 현재 시스템 pass 수준으로 설정한다.

---

### 정리

비례 배분 스케줄링은 CPU를 공정하게 나누는 데 초점을 둔 방식이다.

이론적으로는 깔끔하지만 범용 운영체제의 CPU 스케줄러로는 잘 사용되지 않는다.

입출력과 섞였을 때의 복잡성 추첨권 할당 문제의 어려움 때문이다.

그래서 실제 운영체제에서는 MLFQ나 CFS 같은 방식이 더 널리 사용된다.

다만 가상화 환경처럼 CPU 지분을 명확히 나눠야 하는 경우에는 비례 배분 스케줄링이 여전히 유효한 선택지가 된다.
